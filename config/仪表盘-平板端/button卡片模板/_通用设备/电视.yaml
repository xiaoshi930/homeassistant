电视:
  triggers_update:
    - '[[[ return variables.电视 ?? "" ]]]' 
    - '[[[ return variables.音量 ?? "" ]]]' 
  styles:
    grid:
      - grid-template-areas: |
          "背景图1" 
          "背景图2"
          "播放器"
          "遥控区"
      - grid-template-columns: 100%
      - grid-template-rows: 0px 0px 0px 0px
    card:
      - padding: 0
      - width: 450px
      - height: 608px 
      - border-width: 0
      - border-radius: 10px
      - background: '[[[ return variables.主题 =="on" ? "rgb(255,255,255)" : "rgb(50,50,50)" ]]]'
  custom_fields:
    背景图1:
      card:
        type: custom:button-card
        entity_picture: |
          [[[
              return states[variables.电视].attributes.entity_picture || variables.背景备用图片;
          ]]]
        show_entity_picture: true
        show_name: false
        styles:
          entity_picture:
            - padding: 0
            - width: 100%
            - height: 100%
          card:
            - filter: |
                [[[
                   return "blur(0px) brightness(" + variables.背景图片亮度 + ") grayscale("+ variables.背景图片灰度 +")"
                ]]]
            - margin-top: 300px
            - padding: 0
            - width: 450px 
            - height: 300px
            - border-radius: 0px
            - background: '[[[ return variables.主题=="on" ? "rgb(255,255,255)" : "rgb(50,50,50)" ]]]'
    背景图2:
      card:
        type: custom:button-card
        entity_picture: | 
          [[[
              return states[variables.电视].attributes.entity_picture || variables.背景备用图片;
          ]]]
        show_entity_picture: true
        show_name: false
        styles:
          entity_picture:
            - padding: 0  
            - width: 100%
            - height: 100%
            - transform: rotateX(180deg)
            - mask-image: linear-gradient(to top, rgb(0,0,0) 0%, rgb(0,0,0,0) 80%, rgb(0,0,0,0) 100%)
          card:
            - filter: |
                [[[
                   return "blur(0px) brightness(" + (variables.背景图片亮度-0.1) + ") grayscale("+ variables.背景图片灰度 +")"
                ]]]

            - margin-top: 908px
            - padding: 0
            - width: 450px
            - height: 308px
            - border-radius: 0px 0px 10px 10px
            - background: '[[[ return variables.主题=="on" ? "rgb(255,255,255)" : "rgb(50,50,50)" ]]]'
    播放器:
      card:
        type: custom:button-card   
        styles:
          grid:
            - grid-template-areas: |
                "图标 图标 名称 名称 名称 名称 名称 主页 返回 菜单 设置 开关机"
                "图标 图标 信息 信息 信息 信息 信息 . . 信源1 信源2 信源3"
                "图标 图标 音量 静音 音量减 音量条 音量条 音量加 . 播放 暂停 播放暂停"
                "图标 图标 . . . . . . . . . ."
            - grid-template-columns: 37px 37px 37px 37px 37px 37px 37px 37px 37px 37px 37px 37px
            - grid-template-rows: 25px 25px 25px 25px 
          card:
            - padding: 0 8px 0 8px
            - margin-top: 500px
            - width: 450px
            - height: 100px 
            - border-width: 0
            - border-radius: 10px
            - background: rgb(0,0,0,0)
        custom_fields:
          图标: 
            card:
              type: custom:button-card
              show_entity_picture: true
              show_icon: true
              entity_picture: |
                [[[
                  return states[variables.电视]?.attributes?.entity_picture || "";
                ]]]
              icon: mdi:television-box
              styles:
                icon: 
                  - padding: 0
                  - width: 100%
                  - height: 100%
                entity_picture:
                  - padding: 0
                  - width: 100%
                  - height: 100%
                card: 
                  - padding: 0
                  - width: 60px
                  - height: 60px
                  - border-radius: 50%
                  - animation: |
                      [[[
                          var state = states[variables.电视]?.state;
                          if(state=="on" || state=="idle")
                          return "rotating 8s linear infinite";
                      ]]]
          名称: 
            card:
              type: custom:button-card  
              show_label: true
              label: |
                [[[ 
                    var state = states[variables.电视]?.state;
                    if(state=="idle" || state=="on")
                    state = "开机";
                    if(state=="off")
                    state = "关机";
                    return states[variables.电视]?.attributes?.friendly_name + " - " + state;
                ]]]
              styles:
                label:
                  - width: 220px
                  - text-align: left
                  - font-size: 15px
                  - color: rgb(255,255,255)
                card: 
                  - height: 30px
                  - border-radius: 10px
                  - background: rgb(0,0,0,0)
          信息: 
            card:
              type: custom:button-card  
              show_label: true
              label: |
                [[[ 
                    var title = states[variables.电视]?.attributes?.app_current ?? "";
                    return title;
                ]]]
              styles:
                label: 
                  - width: 220px
                  - text-align: left
                  - font-size: 13px
                  - color: rgb(255,255,255)
                card: 
                  - height: 30px
                  - border-radius: 10px
                  - background: rgb(0,0,0,0)
          音量: 
            card:
              type: custom:button-card   
              show_label: true
              label: '[[[ return Math.round(states[variables.音量]?.state,0)+"%" ]]]'
              styles:
                label: 
                  - font-size: 15px
                  - color: rgb(255,255,255)
                card: 
                  - height: 30px
                  - border-radius: 10px
                  - background: rgb(0,0,0,0)
          主页: 
            card:
              type: custom:button-card   
              icon: mdi:home
              template: 电视播放器按钮样式_图标
              tap_action:
                action: call-service
                service: select.select_option
                data: 
                  option: "home"
                target:
                  entity_id: '[[[ return variables.播放控制 ]]]'
          菜单: 
            card:
              type: custom:button-card   
              icon: mdi:menu
              template: 电视播放器按钮样式_图标
              tap_action:
                action: call-service
                service: select.select_option
                data: 
                  option: "menu"
                target:
                  entity_id: '[[[ return variables.播放控制 ]]]'
          返回: 
            card:
              type: custom:button-card   
              icon: mdi:arrow-u-left-top
              template: 电视播放器按钮样式_图标
              tap_action:
                action: call-service
                service: select.select_option
                data: 
                  option: "back"
                target:
                  entity_id: '[[[ return variables.播放控制 ]]]'
          设置: 
            card: 
              type: custom:button-card   
              icon: mdi:cog
              template: 电视播放器按钮样式_图标
              tap_action:
                action: call-service
                service: select.select_option
                data: 
                  option: '电视管家 - com.xiaomi.mitv.tvmanager'
                target:
                  entity_id: '[[[ return variables.播放控制app ]]]'
          开关机: 
            card:
              type: custom:button-card 
              icon: mdi:power
              template: 电视播放器按钮样式_图标
              tap_action:
                action: call-service
                service:  |
                  [[[
                    var state = states[variables.电视]?.state;
                    if(state=="idle" || state=="on") return "media_player.turn_off"
                    if(state=="off")                 return "button.press"
                  ]]]
                data: {}
                target:
                  entity_id: |
                    [[[
                      var state = states[variables.电视]?.state;
                      if(state=="idle" || state=="on")  return variables.电视;
                      if(state=="off")                  return variables.打开电视;
                    ]]]
          信源1: 
            card:
              type: custom:button-card   
              icon: mdi:high-definition
              template: 电视播放器按钮样式_图标
              styles: 
                card:
                  - position: relative
                custom_fields:
                  num:
                    - position: absolute
                    - bottom: 20%
                    - right: 10%
                    - font-size: 8px
                    - font-weight: bold
                    - color: rgb(255,255,255)
                    - background: rgb(0,0,0,0)
                    - width: 10px
                    - height: 10px
                    - line-height: 10px
                    - text-align: center
              custom_fields:
                num: 1
              tap_action:
                action: call-service
                service:  media_player.select_source
                data: 
                  source: "HDMI 1"
                target:
                  entity_id: '[[[ return variables.电视 ]]]'
          信源2: 
            card:
              type: custom:button-card   
              icon: mdi:high-definition
              template: 电视播放器按钮样式_图标
              styles: 
                card:
                  - position: relative
                custom_fields:
                  num:
                    - position: absolute
                    - bottom: 20%
                    - right: 10%
                    - font-size: 8px
                    - font-weight: bold
                    - color: rgb(255,255,255)
                    - background: rgb(0,0,0,0)
                    - width: 10px
                    - height: 10px
                    - line-height: 10px
                    - text-align: center
              custom_fields:
                num: 2
              tap_action:
                action: call-service
                service:  media_player.select_source
                data: 
                  source: "HDMI 2"
                target:
                  entity_id: '[[[ return variables.电视 ]]]'
          信源3: 
            card:
              type: custom:button-card   
              icon: mdi:high-definition
              template: 电视播放器按钮样式_图标
              styles: 
                card:
                  - position: relative
                custom_fields:
                  num:
                    - position: absolute
                    - bottom: 20%
                    - right: 10%
                    - font-size: 8px
                    - font-weight: bold
                    - color: rgb(255,255,255)
                    - background: rgb(0,0,0,0)
                    - width: 10px
                    - height: 10px
                    - line-height: 10px
                    - text-align: center
              custom_fields:
                num: 3
              tap_action:
                action: call-service
                service:  media_player.select_source
                data: 
                  source: "HDMI 3"
                target:
                  entity_id: '[[[ return variables.电视 ]]]'
          静音: 
            card:
              type: custom:button-card
              icon: mdi:volume-mute
              template: 电视播放器按钮样式_图标
              tap_action:
                action: call-service
                service: media_player.volume_mute
                data: 
                  is_volume_muted: true
                target:
                  entity_id: '[[[ return variables.电视 ]]]'
          音量减: 
            card:
              type: custom:button-card
              icon: mdi:volume-minus
              template: 电视播放器按钮样式_图标
              tap_action:
                action: call-service
                service:  number.set_value
                data: 
                  value: |
                    [[[
                        var number = states[variables.音量]?.state;
                        return number >=1 ? number-1 : number;
                    ]]]
                target:
                  entity_id: '[[[ return variables.音量 ]]]'
          音量加: 
            card:
              type: custom:button-card  
              icon: mdi:volume-plus
              template: 电视播放器按钮样式_图标
              tap_action:
                action: call-service
                service:  number.set_value 
                data: 
                  value: |
                    [[[
                        var number = states[variables.音量]?.state;
                        return number >= 100 ? number : number-(-1);
                    ]]]
                target:
                  entity_id: '[[[ return variables.音量 ]]]'
          播放: 
            card:
              type: custom:button-card  
              icon: mdi:play
              template: 电视播放器按钮样式_图标
              tap_action:
                action: call-service
                service:  media_player.media_play
                data: {}
                target:
                  entity_id: '[[[ return variables.电视 ]]]'
          暂停: 
            card:
              type: custom:button-card  
              icon: mdi:pause
              template: 电视播放器按钮样式_图标
              tap_action:
                action: call-service
                service:  media_player.media_pause
                data: {}
                target:
                  entity_id: '[[[ return variables.电视 ]]]'
          播放暂停: 
            card:
              type: custom:button-card  
              icon: mdi:play-pause
              template: 电视播放器按钮样式_图标
              tap_action:
                action: call-service
                service: select.select_option
                data: 
                  option: "play_pause"
                target:
                  entity_id: '[[[ return variables.播放控制 ]]]'
          音量条: 
            card:
              type: custom:xiaoshi-slider-card
              entity: '[[[ return variables.音量 ]]]'
              style:
                slider-width: 70px
                track-height: 6px
                track-radius: 4px
    遥控区:
      card:
        type: custom:button-card   
        styles:
          grid:
            - grid-template-areas: |
                ". . . . . . ."
                ". 方向按键 方向按键 方向按键 方向按键 方向按键 ."
                ". 方向按键 方向按键 方向按键 方向按键 方向按键 ."
                ". 方向按键 方向按键 方向按键 方向按键 方向按键 ."
                ". . . . . . ."
                "app1 app2 app3 app4 app5 app6 app7"
            - grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr
            - grid-template-rows: 1fr 1fr 1fr 1fr 1fr 1fr 
            - justify-items: center
            - align-items: center
          card:
            - padding: 0
            - margin-top: 908px
            - width: 450px
            - height: 300px 
            - border-width: 0
            - border-radius: 0%
            - background: rgb(0,0,0,0)
            - position: relative
        custom_fields:
          方向按键: 
            card:
              type: custom:button-card   
              styles:
                function: |
                  [[[
                      window.r = 80;                  //半径
                      window.d = r * Math.SQRT2 / 2;  //直角边
                  ]]]
                grid:
                  - grid-template-areas: |
                      ". . . . ."
                      ". . 上 . ."
                      ". 左 确认 右 ."
                      ". . 下 . ."
                      ". . . . ."
                  - grid-template-columns: 1fr 1fr 1fr 1fr 1fr
                  - grid-template-rows: 1fr 1fr 1fr 1fr 1fr 
                  - justify-items: center
                  - align-items: center
                card:
                  - padding: 0
                  - width: '[[[return 2*r+"px" ]]]'
                  - height: '[[[return 2*r+"px" ]]]'
                  - border-width: 0
                  - border-radius: 50%
                  - background: rgb(220,0,0,0)
                  - position: relative
              custom_fields:
                上: 
                  card:
                    type: custom:button-card   
                    show_icon: true  
                    icon: mdi:circle-small
                    styles:
                      icon: 
                        - color: '[[[ return variables.主题 =="on" ? "rgb(255,255,255)" : "rgb(0,0,0)" ]]]'
                        - width: '[[[return 0.3*r+"px" ]]]'
                        - height: '[[[return 0.3*r+"px" ]]]'
                        - position: absolute
                        - top: 15%
                        - left: 50%
                        - transform: translate(-50%, -50%)
                      card:  
                        - padding: 0
                        - position: absolute
                        - margin-top: '[[[return 0.4*r+"px" ]]]'
                        - width: '[[[return 2*r+"px" ]]]'
                        - height: '[[[return 2*r+"px" ]]]'
                        - clip-path: |
                            [[[
                               return `path('M ${r},${r}  L ${r+d},${r-d}  A ${r},${r}  90 0, 0  ${r-d},${r-d} Z')`
                            ]]]
                        - background: '[[[ return variables.主题 =="on" ? "rgb(80,80,80,0.8)" : "rgb(200,200,200,0.8)" ]]]'
                        - transform: translate(-50%, -50%)
                    tap_action:
                      action: call-service
                      service: select.select_option
                      data: 
                        option: "up"
                      target:
                        entity_id: '[[[ return variables.播放控制 ]]]'
                下: 
                  card:
                    type: custom:button-card   
                    show_icon: true  
                    icon: mdi:circle-small
                    styles:
                      icon:
                        - color: '[[[ return variables.主题 =="on" ? "rgb(255,255,255)" : "rgb(0,0,0)" ]]]'
                        - width: '[[[return 0.3*r+"px" ]]]'
                        - height: '[[[return 0.3*r+"px" ]]]'
                        - position: absolute
                        - top: 85%
                        - left: 50%
                        - transform: translate(-50%, -50%)
                      card: 
                        - position: absolute
                        - margin-top: '[[[return "-"+0.4*r+"px" ]]]'
                        - top: 50%
                        - left: 50%
                        - width: '[[[return 2*r+"px" ]]]'
                        - height: '[[[return 2*r+"px" ]]]'
                        - clip-path: |
                            [[[
                               return `path('M ${r},${r}  L ${r-d},${r+d}  A ${r},${r}  90 0, 0  ${r+d},${r+d} Z')`
                            ]]]
                        - background: '[[[ return variables.主题 =="on" ? "rgb(80,80,80,0.8)" : "rgb(200,200,200,0.8)" ]]]'
                        - transform: translate(-50%, -50%)
                    tap_action:
                      action: call-service
                      service: select.select_option
                      data: 
                        option: "down"
                      target:
                        entity_id: '[[[ return variables.播放控制 ]]]'
                左: 
                  card:
                    type: custom:button-card   
                    show_icon: true  
                    icon: mdi:circle-small
                    styles:
                      icon:
                        - color: '[[[ return variables.主题 =="on" ? "rgb(255,255,255)" : "rgb(0,0,0)" ]]]'
                        - width: '[[[return 0.3*r+"px" ]]]'
                        - height: '[[[return 0.3*r+"px" ]]]'
                        - position: absolute
                        - top: 50%
                        - left: 15%
                        - transform: translate(-50%, -50%)
                      card: 
                        - position: absolute
                        - margin-left: '[[[return 0.4*r+"px" ]]]'
                        - top: 50%
                        - left: 50%
                        - width: '[[[return 2*r+"px" ]]]'
                        - height: '[[[return 2*r+"px" ]]]'
                        - clip-path: |
                            [[[
                               return `path('M ${r},${r}  L ${r-d},${r-d}  A ${r},${r}  90 0, 0  ${r-d},${r+d} Z')`
                            ]]]
                        - background: '[[[ return variables.主题 =="on" ? "rgb(80,80,80,0.8)" : "rgb(200,200,200,0.8)" ]]]'
                        - transform: translate(-50%, -50%)
                    tap_action:
                      action: call-service
                      service: select.select_option
                      data: 
                        option: "left"
                      target:
                        entity_id: '[[[ return variables.播放控制 ]]]'
                右: 
                  card:
                    type: custom:button-card    
                    show_icon: true  
                    icon: mdi:circle-small
                    styles:
                      icon:
                        - color: '[[[ return variables.主题 =="on" ? "rgb(255,255,255)" : "rgb(0,0,0)" ]]]'
                        - width: '[[[return 0.3*r+"px" ]]]'
                        - height: '[[[return 0.3*r+"px" ]]]'
                        - position: absolute
                        - top: 50%
                        - left: 85%
                        - transform: translate(-50%, -50%)
                      card: 
                        - position: absolute
                        - margin-left: '[[[return "-"+0.4*r+"px" ]]]'
                        - top: 50%
                        - left: 50%
                        - width: '[[[return 2*r+"px" ]]]'
                        - height: '[[[return 2*r+"px" ]]]'
                        - clip-path: |
                            [[[
                               return `path('M ${r},${r}  L ${r+d},${r+d}  A ${r},${r}  90 0, 0  ${r+d},${r-d} Z')`
                            ]]]
                        - background: '[[[ return variables.主题 =="on" ? "rgb(80,80,80,0.8)" : "rgb(200,200,200,0.8)" ]]]'
                        - transform: translate(-50%, -50%)
                    tap_action:
                      action: call-service
                      service: select.select_option
                      data: 
                        option: "right"
                      target:
                        entity_id: '[[[ return variables.播放控制 ]]]'
                确认: 
                  card:
                    type: custom:button-card   
                    show_label: true
                    styles:
                      label: 
                        - font-size: 13px
                        - color: '[[[ return variables.主题 =="on" ? "rgb(255,255,255)" : "rgb(0,0,0)" ]]]'
                      card: 
                        - position: absolute
                        - top: 50%
                        - left: 50%
                        - width: '[[[return 0.75*r+"px" ]]]'
                        - height: '[[[return 0.75*r+"px" ]]]'
                        - border-radius: 50%
                        - transform: translate(-50%, -50%)
                        - background: '[[[ return variables.主题 =="on" ? "rgb(80,80,80)" : "rgb(200,200,200)" ]]]'
                    label: ok
                    tap_action:
                      action: call-service
                      service: select.select_option
                      data: 
                        option: "enter"
                      target:
                        entity_id: '[[[ return variables.播放控制 ]]]'
          app1: 
            card:
              type: custom:button-card    
              template: 电视按钮样式_app
              entity_picture: '[[[ return variables.app1logo]]]'
              variables:      
                主题: '[[[ return variables.主题 ]]]'
              tap_action:
                action: call-service
                service: select.select_option
                data: 
                  option: '[[[ return variables.app1 ]]]'
                target:
                  entity_id: '[[[ return variables.播放控制app ]]]'
          app2: 
            card:
              type: custom:button-card    
              template: 电视按钮样式_app
              entity_picture: '[[[ return variables.app2logo]]]'
              variables:      
                主题: '[[[ return variables.主题 ]]]'
              tap_action:
                action: call-service
                service: select.select_option
                data: 
                  option: '[[[ return variables.app2 ]]]'
                target:
                  entity_id: '[[[ return variables.播放控制app ]]]'
          app3: 
            card:
              type: custom:button-card    
              template: 电视按钮样式_app
              entity_picture: '[[[ return variables.app3logo]]]'
              variables:      
                主题: '[[[ return variables.主题 ]]]'
              tap_action:
                action: call-service
                service: select.select_option
                data: 
                  option: '[[[ return variables.app3 ]]]'
                target:
                  entity_id: '[[[ return variables.播放控制app ]]]'
          app4: 
            card:
              type: custom:button-card    
              template: 电视按钮样式_app
              entity_picture: '[[[ return variables.app4logo]]]'
              variables:      
                主题: '[[[ return variables.主题 ]]]'
              tap_action:
                action: call-service
                service: select.select_option
                data: 
                  option: '[[[ return variables.app4 ]]]'
                target:
                  entity_id: '[[[ return variables.播放控制app ]]]'
          app5: 
            card:
              type: custom:button-card    
              template: 电视按钮样式_app
              entity_picture: '[[[ return variables.app5logo]]]'
              variables:      
                主题: '[[[ return variables.主题 ]]]'
              tap_action:
                action: call-service
                service: select.select_option
                data: 
                  option: '[[[ return variables.app5 ]]]'
                target:
                  entity_id: '[[[ return variables.播放控制app ]]]'
          app6: 
            card:
              type: custom:button-card    
              template: 电视按钮样式_app
              entity_picture: '[[[ return variables.app6logo]]]'
              variables:      
                主题: '[[[ return variables.主题 ]]]'
              tap_action:
                action: call-service
                service: select.select_option
                data: 
                  option: '[[[ return variables.app6 ]]]'
                target:
                  entity_id: '[[[ return variables.播放控制app ]]]'
          app7: 
            card:
              type: custom:button-card    
              template: 电视按钮样式_app
              entity_picture: '[[[ return variables.app7logo]]]'
              variables:      
                主题: '[[[ return variables.主题 ]]]'
              tap_action:
                action: call-service
                service: select.select_option
                data: 
                  option: '[[[ return variables.app7 ]]]'
                target:
                  entity_id: '[[[ return variables.播放控制app ]]]'

电视按钮样式_app:
  show_entity_picture: true
  styles:
    entity_picture:
      - width: 55px
      - height: 30px
      - border-radius: 10px
    card: 
      - width: 55px
      - height: 30px
      - border-radius: 10px
      - background: '[[[ return variables.主题 =="on" ? "rgb(100,100,100)" : "rgb(150,150,150)" ]]]'

电视播放器按钮样式_图标: 
  show_icon: true  
  styles:
    icon:
      - width: 20px
      - height: 20px
      - color: rgb(255,255,255)
    card: 
      - width: 35px
      - height: 30px
      - border-radius: 10px
      - background: rgb(0,0,0,0)