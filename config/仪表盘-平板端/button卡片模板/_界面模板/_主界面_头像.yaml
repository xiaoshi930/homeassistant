ä¸»ç•Œé¢_å¤´åƒ:
  triggers_update: all
  styles:   
    grid:
      - grid-template-areas: >-
          [[[
              var tel = variables.ç”µè¯è´¹?.length || 0;
              if (tel > 0){
                return `"å›å®¶ å¤´åƒ ." 
                        ". å¤´åƒ ."  
                        ". å¤´åƒ ."  
                        ". å¤´åƒ ."  
                        "å§“å å§“å å§“å"  
                        "è·å®¶ä¿¡æ¯ è·å®¶ä¿¡æ¯ è·å®¶ä¿¡æ¯"       
                        "ç”µè¯ä¿¡æ¯ ç”µè¯ä¿¡æ¯ ç”µè¯ä¿¡æ¯"
                        "å¼¹å‡ºèœå• å¼¹å‡ºèœå• å¼¹å‡ºèœå•"`
              }
              else {
                return `"å›å®¶ å¤´åƒ ."  
                        ". å¤´åƒ ."   
                        ". å¤´åƒ ."  
                        ". å¤´åƒ ."  
                        "å§“å å§“å å§“å" 
                        "è·å®¶ä¿¡æ¯ è·å®¶ä¿¡æ¯ è·å®¶ä¿¡æ¯"
                        "å¼¹å‡ºèœå• å¼¹å‡ºèœå• å¼¹å‡ºèœå•"`
              }
          ]]]
      - grid-template-columns: 35px 35px 35px
      - grid-template-rows: |
          [[[
              var tel = variables.ç”µè¯è´¹?.length || 0;
              if (tel > 0){
                return `16px 18px 8px 8px 16px 23px 21px 120px`
              }
              else {
                return `16px 18px 8px 8px 34px 26px 120px`
              }
          ]]]
      - font-size: 10px
      - color: rgb(175,238,238)
    card:
      - padding: 5px 5px 0 5px
      - width: 115px  
      - height: 120px   
      - border-radius: 10px
      - border-color: transparent
      - background: |
          [[[
             return theme()=="on" ? "rgb(0,0,0,0.3)" : "rgb(255,255,255,0.25)"
          ]]]
    custom_fields:
      å›å®¶:
        - text-align: left
        - overflow: visible 
        - align-self: start
  custom_fields: 
    å¤´åƒ: 
      card:
        type: custom:button-card
        show_entity_picture: true
        show_name: false
        entity_picture: '[[[ return states[variables.äººå‘˜å®ä½“]?.attributes?.entity_picture ?? ""]]]'
        styles:
          custom_fields:
            progress:
              - padding: 0
              - position: absolute
              - align-self: start
              - width: 48px
              - height: 48px
              - margin-left: 0px 
              - margin-top: 0px
              - border-radius: 50%
              - background: |
                  [[[            
                    var dianliang =states[variables.äººå‘˜appç”µé‡]?.state || "0";
                    const percentage = Math.min(100, Math.max(0, dianliang));
                    const color = `hsl(${percentage}, 80%, 50%)`;
                    return `conic-gradient(${color} 0% ${percentage}%, transparent ${percentage}% 100%)`;
                  ]]]
              - mask: radial-gradient(transparent 57%, black 32%)
              - z-index: -1
          entity_picture:
            - width: 40px
            - height: 40px
            - border-radius: 100%
          card:  
            - padding: 0
            - width: 48px
            - height: 48px
            - background: rgb(0,0,0,0)
            - border-radius: 100%

        custom_fields:
          progress: ""
    å›å®¶: |
      [[[         
          const entityId = variables.äººå‘˜å›å®¶æ—¶é—´;
          if (!entityId || !states[entityId]) return "";
          const time = parseFloat(states[entityId]?.attributes?.é©¾è½¦é€šå‹¤æ—¶é—´ ?? "0") || 0;
          const dis = parseFloat(states[entityId]?.attributes?.é©¾è½¦é€šå‹¤è·ç¦» ?? "0") || 0;
          const time2 = time >= 180 ? (time / 60).toFixed(1) + " h" : Math.round(time) + " min";
          const dis2 = dis >= 0 ? dis.toFixed(1) + " km" : "0 km";
          const label = `${dis2}<br>${time2}<br><br>`;
          if (states[variables.äººå‘˜ipå®ä½“]?.state === 'home')
              return `<font color="#afeeee"><b>${label}</b></font>`;
          if (states[variables.äººå‘˜ipå®ä½“]?.state === 'not_home')
              return `<font color="#FF7F50"><b>${label}</b></font>`;
      ]]]
    å§“å: 
      card:
        type: custom:button-card
        show_label: true
        label: |
          [[[ 
              var shengri1 = states[variables.ä¸‡å¹´å†?.å®ä½“]?.attributes?.ç”Ÿæ—¥[variables.ä¸‡å¹´å†?.ä½ç½®]?.å†œå†å¤©æ•°;
              var shengri2 = states[variables.ä¸‡å¹´å†?.å®ä½“]?.attributes?.ç”Ÿæ—¥[variables.ä¸‡å¹´å†?.ä½ç½®]?.é˜³å†å¤©æ•°;
              var shengri;
              if ((shengri1 != null && shengri1 !== "") && (shengri2 != null && shengri2 !== "")) {
                  shengri = Math.min(Number(shengri1), Number(shengri2));
              } else if (shengri1 != null && shengri1 !== "") {
                  shengri = Number(shengri1);
              } else if (shengri2 != null && shengri2 !== "") {
                  shengri = Number(shengri2);
              } else {
                  shengri = -1; 
              }
              if (shengri == 0) {
                  return variables.å§“å + '<font size ="1"><b>&ensp;ğŸ‚ä»Šå¤©</b></font>';
              } else if (shengri >= 20) {
                  return variables.å§“å + '<font size ="1"><b>&ensp;ğŸ‚' + shengri + 'å¤©</b></font>';
              } else if (shengri > 0) {
                  return variables.å§“å + '<font size ="1" color="#FF7f50"><b>&ensp;ğŸ‚' + shengri + 'å¤©</b></font>';
              } else {
                  return variables.å§“å; 
              }
          ]]]
        styles:
          card:
            - padding: 5px 0 0 0
            - background: transparent 
          label:
            - font-size: 15px
            - color: |
                [[[
                  if (states[variables.äººå‘˜ipå®ä½“]?.state =='home') return 'rgb(175,238,238)';   
                  if (states[variables.äººå‘˜ipå®ä½“]?.state =='not_home') return 'rgb(255,127,80)';       
                ]]] 
    è·å®¶ä¿¡æ¯: 
      card:
        type: custom:button-card
        show_label: true
        label: |
          [[[ 
              var lat1 = states["zone.home"].attributes.latitude;    // homeçº¬åº¦
              var lng1 = states["zone.home"].attributes.longitude;   // homeç»åº¦
              var lat2 = states[variables.äººå‘˜appå®ä½“]?.attributes?.latitude;    // æ‰‹æœºçº¬åº¦
              var lng2 = states[variables.äººå‘˜appå®ä½“]?.attributes?.longitude;   // æ‰‹æœºç»åº¦
              var radLat1 =lat1 * Math.PI / 180.0
              var radLat2 =lat2 * Math.PI / 180.0
              var radLng1 =lng1 * Math.PI / 180.0
              var radLng2 =lng2 * Math.PI / 180.0
              var a = radLat1 - radLat2; 
              var b = radLng1 - radLng2;
              var s = 2 * Math.asin(Math.sqrt(Math.pow(Math.sin(a / 2), 2) + Math.cos(radLat1) * Math.cos(radLat2) * Math.pow(Math.sin(b / 2), 2)));     
    
              var date1 = new Date();        //ç°åœ¨æ—¶é—´
              var time1 = date1.getTime();
              var d = states[variables.äººå‘˜ipå®ä½“]?.last_changed ?? "";   //æœ€åæ›´æ–°æ—¶é—´
              var date2 = new Date(d.slice(0, 19));
              var time2 = date2.getTime();
              var time = ((time1-time2)/3600000-8).toFixed(1);  //æ—¶é—´æ•°å€¼
              var time = time > 24 ? (time/24).toFixed(1)+"d" : time + "h";

              return Math.round(s * 6378.137 *10 ) / 10 +"km" +"&ensp;&ensp;" + time;
          ]]]
        styles:
          card:
            - background: transparent 
            - overflow: visible
          label:
            - color: |
                [[[
                  if (states[variables.äººå‘˜ipå®ä½“]?.state =='home') return 'rgb(175,238,238)';   
                  if (states[variables.äººå‘˜ipå®ä½“]?.state =='not_home') return 'rgb(255,127,80)';       
                ]]] 
            - font-size: 11px
            - overflow: visible
    ç”µè¯ä¿¡æ¯: 
      card:
        type: custom:button-card
        styles:   
          grid:
            - grid-template-areas: >-
                [[[
                    var tel = variables.ç”µè¯è´¹?.length || 0;
                    if (tel == 3){
                      return `"ç”µè¯1 ç”µè¯2 ç”µè¯3"`
                    }
                    if (tel == 2){
                      return `"ç”µè¯1 ç”µè¯2"`
                    }
                    if (tel == 1){
                      return `"ç”µè¯1"`
                    }
                    else {
                      return `"ç”µè¯1 ç”µè¯2 ç”µè¯3"`
                    }
                ]]]
            - grid-template-columns: |
                [[[
                    var tel = variables.ç”µè¯è´¹?.length || 0;
                    if (tel == 3){
                      return `33px 38px 38px`
                    }
                    if (tel == 2){
                      return `50% 50%`
                    }
                    if (tel == 1){
                      return `100%`
                    }
                    else {
                      return `38px 38px 38px`
                    }
                ]]]
            - grid-template-rows: 25px
            - font-size: 10px
            - color: rgb(175,238,238)
            - overflow: visible
          card:
            - padding: 0
            - width: 115px  
            - height: 25px    
            - border-radius: 10px
            - border-color: transparent
            - background: transparent
            - overflow: visible
        custom_fields: 
          ç”µè¯1: | 
            [[[ 
                var name = variables.ç”µè¯è´¹?.[0]?.name ?? "";
                var state = states[variables.ç”µè¯è´¹?.[0]?.entity]?.state ?? "";
                return state>=30 ? name+'<br>'+state : name+'<font color="#FF2000"><b><br>'+state+'</b></font>';
            ]]]
          ç”µè¯2: | 
            [[[ 
                var name = variables.ç”µè¯è´¹?.[1]?.name ?? "";
                var state = states[variables.ç”µè¯è´¹?.[1]?.entity]?.state ?? "";
                return state>=30 ? name+'<br>'+state : name+'<font color="#FF2000"><b><br>'+state+'</b></font>';
            ]]]
          ç”µè¯3: | 
            [[[ 
                var name = variables.ç”µè¯è´¹?.[2]?.name ?? "";
                var state = states[variables.ç”µè¯è´¹?.[2]?.entity]?.state ?? "";
                return state>=30 ? name+'<br>'+state : name+'<font color="#FF2000"><b><br>'+state+'</b></font>';
            ]]]
    å¼¹å‡ºèœå•: 
      card:
        type: custom:button-card
        styles:   
          card: 
            - padding: 0
            - width: 115px  
            - height: 120px    
            - margin-top: -175.5px
            - margin-left: -5px
            - background: rgb(0,0,0,0)

        tap_action:  
          action: fire-dom-event   
          browser_mod:
            service: browser_mod.popup
            data:
              style: |
                [[[ 
                    var home = states[variables.äººå‘˜ipå®ä½“].state;
                    return theme_none_touxiang(home,800);  
                ]]]
              content:
                type: horizontal-stack
                cards:
                  - type: vertical-stack
                    cards:
                      - type: custom:xiaoshi-birthday-card
                        entity: sensor.lunar_calendar
                        theme: '[[[ return theme() ]]]'
                        items:
                          - index: "0"
                          - index: "1"
                          - index: "2"
                      - type: custom:xiaoshi-balance-card
                        theme: '[[[ return theme() ]]]'
                        entities:
                          - entity_id: sensor.tel_api
                          - entity_id: sensor.tel199_2769
                          - entity_id: sensor.tel195_0769
                          - entity_id: sensor.tel137_9221
                          - entity_id: sensor.tel182_7461
                  - type: map
                    entities:
                      - entity: |
                          [[[ 
                              return variables.äººå‘˜å®ä½“ 
                          ]]]
                    hours_to_show: 24
                    aspect_ratio: '[[[ return variables.åœ°å›¾æ¯”ä¾‹ ]]]'
                    theme_mode: auto
                    card_mod: 
                      style: 
                        ha-map $ ha-entity-marker $: |
                          .marker {
                            border: 3px solid var(--state-person) !important;
                            border-radius: 50% 50% 50% 0px !important;
                            transform: rotate(-45deg) translate(50%, -50%);
                            overflow: visible !important;
                            background: var(--state-person) !important;
                          }
                          .entity-picture {
                            transform: rotate(45deg);
                            border-radius: 50%;
                          }
                        ha-map $: '[[[return theme_ha_map(variables.äººå‘˜å›å®¶æ—¶é—´)]]]'
                        .: |
                          ha-card {
                            box-shadow: none;
                            border-width: 0;
                          }
                          ha-icon-button {
                            margin: 0px 7px 0px;
                            color: orange !important;
                            background: rgb(0,0,0,0.2);
                            border-radius: 20%;
                            border: 1px solid rgb(255,255,255,0.5) !important;
                          }   